{"ast":null,"code":"\"use strict\";var _defineProperty=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/defineProperty\");var _regeneratorRuntime=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/regenerator\");var _asyncToGenerator=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/asyncToGenerator\");function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!==\"undefined\"&&o[Symbol.iterator]||o[\"@@iterator\"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it[\"return\"]!=null)it[\"return\"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||(\"get\"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function get(){return m[k];}};}Object.defineProperty(o,k2,desc);}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k];});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,\"default\",{enumerable:true,value:v});}:function(o,v){o[\"default\"]=v;});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod){if(k!==\"default\"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);}__setModuleDefault(result,mod);return result;};Object.defineProperty(exports,\"__esModule\",{value:true});exports.getChromeIconConfig=exports.getFaviconIconConfig=exports.getSafariIconConfig=exports.getSafariStartupImageConfig=exports.getConfigForPWA=exports.generateManifestJson=exports.generateManifestAsync=exports.generateFaviconAsync=exports.generateChromeIconAsync=exports.generateAppleIconAsync=exports.generateSplashAsync=exports.generateAsync=exports.joinUrlPath=void 0;var config_1=require(\"@expo/config\");var Image=__importStar(require(\"@expo/image-utils\"));var path=__importStar(require(\"path\"));var url_1=require(\"url\");var Manifest_1=require(\"./Manifest\");Object.defineProperty(exports,\"getConfigForPWA\",{enumerable:true,get:function get(){return Manifest_1.getConfigForPWA;}});var Splash_1=require(\"./Splash\");/**\n * Joins a url protocol + host to path segments, falls back to path.join\n * if result is not a valid url.\n */function joinUrlPath(publicPath){for(var _len=arguments.length,toJoin=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){toJoin[_key-1]=arguments[_key];}var segments=path.join.apply(path,toJoin);try{// Throws if publicPath is not a valid protocol+host\nreturn new url_1.URL(segments,publicPath).href;}catch(_unused){return path.join(publicPath,segments);}}exports.joinUrlPath=joinUrlPath;function generateAsync(_x,_x2,_x3){return _generateAsync.apply(this,arguments);}function _generateAsync(){_generateAsync=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(type,options,icon){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=type;_context.next=_context.t0==='splash'?3:_context.t0==='safari-icon'?4:_context.t0==='chrome-icon'?5:_context.t0==='favicon'?6:7;break;case 3:return _context.abrupt(\"return\",generateSplashAsync(options,icon));case 4:return _context.abrupt(\"return\",generateAppleIconAsync(options,icon,{}));case 5:return _context.abrupt(\"return\",generateChromeIconAsync(options,icon,{}));case 6:return _context.abrupt(\"return\",generateFaviconAsync(options,icon));case 7:throw new Error(\"Invalid command type: \".concat(type));case 8:case\"end\":return _context.stop();}}},_callee);}));return _generateAsync.apply(this,arguments);}exports.generateAsync=generateAsync;function generateSplashAsync(_x4,_x5){return _generateSplashAsync.apply(this,arguments);}function _generateSplashAsync(){_generateSplashAsync=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref,icon){var projectRoot,publicPath,cacheType,devices,icons,_iterator,_step,device,_iterator2,_step2,orientation,width,height,name,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:projectRoot=_ref.projectRoot,publicPath=_ref.publicPath;cacheType='apple-touch-startup-image';// You cannot lock iOS PWA orientation, we should produce every splash screen\n// orientation. We don't however because in iOS 13 it's far more rare to see landscape splash screens.\ndevices=(0,Splash_1.getDevices)();icons=Array.isArray(icon)?icon:[];if(!Array.isArray(icon)){_iterator=_createForOfIteratorHelper(devices);try{for(_iterator.s();!(_step=_iterator.n()).done;){device=_step.value;_iterator2=_createForOfIteratorHelper(device.orientations);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){orientation=_step2.value;width=0;height=0;if(orientation!=='portrait'){width=device.height;height=device.width;}else{height=device.height;width=device.width;}name=\"apple-touch-startup-image-\".concat(width,\"x\").concat(height,\".png\");icons.push(_objectSpread(_objectSpread({},icon),{},{name:name,width:width,height:height,media:(0,Splash_1.assembleOrientationMedia)(device.width,device.height,device.scale,orientation)}));}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}}catch(err){_iterator.e(err);}finally{_iterator.f();}}_context3.next=7;return Promise.all(icons.map(/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(icon){var _yield$Image$generate,source,name,href;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:// Ensure the default `splash.resizeMode` is used here:\n// https://docs.expo.dev/versions/latest/config/app/#splash\nif(!icon.resizeMode){icon.resizeMode='contain';}_context2.next=3;return Image.generateImageAsync({projectRoot:projectRoot,cacheType:cacheType},icon);case 3:_yield$Image$generate=_context2.sent;source=_yield$Image$generate.source;name=_yield$Image$generate.name;href=\"pwa/apple-touch-startup-image/\".concat(name);return _context2.abrupt(\"return\",{asset:{source:source,path:href},tag:{tagName:'link',attributes:{rel:'apple-touch-startup-image',media:icon.media,// TODO(Bacon): Use sizes to query splash screens better\n// sizes: `${icon.width}x${icon.height}`,\nhref:joinUrlPath(publicPath,href)}}});case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x17){return _ref8.apply(this,arguments);};}()));case 7:data=_context3.sent;_context3.next=10;return Image.Cache.clearUnusedCachesAsync(projectRoot,cacheType);case 10:return _context3.abrupt(\"return\",data);case 11:case\"end\":return _context3.stop();}}},_callee3);}));return _generateSplashAsync.apply(this,arguments);}exports.generateSplashAsync=generateSplashAsync;function generateAppleIconAsync(_x6,_x7,_x8){return _generateAppleIconAsync.apply(this,arguments);}function _generateAppleIconAsync(){_generateAppleIconAsync=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(_ref2,icon,_ref3){var projectRoot,publicPath,_ref3$sizes,sizes,cacheType,data;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:projectRoot=_ref2.projectRoot,publicPath=_ref2.publicPath;_ref3$sizes=_ref3.sizes,sizes=_ref3$sizes===void 0?[180]:_ref3$sizes;cacheType='apple-touch-icon';_context5.next=5;return Promise.all(sizes.map(/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(size){var rel,_yield$Image$generate2,source,name,href;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:rel='apple-touch-icon';_context4.next=3;return Image.generateImageAsync({projectRoot:projectRoot,cacheType:cacheType},_objectSpread(_objectSpread({},icon),{},{width:size,height:size,name:\"\".concat(rel,\"-\").concat(size,\".png\")}));case 3:_yield$Image$generate2=_context4.sent;source=_yield$Image$generate2.source;name=_yield$Image$generate2.name;href=\"pwa/\".concat(rel,\"/\").concat(name);return _context4.abrupt(\"return\",{asset:{source:source,path:href},tag:{tagName:'link',attributes:{rel:rel,sizes:\"\".concat(size,\"x\").concat(size),href:joinUrlPath(publicPath,href)}}});case 8:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x18){return _ref9.apply(this,arguments);};}()));case 5:data=_context5.sent;if(sizes.length){_context5.next=9;break;}_context5.next=9;return Image.Cache.clearUnusedCachesAsync(projectRoot,cacheType);case 9:return _context5.abrupt(\"return\",data);case 10:case\"end\":return _context5.stop();}}},_callee5);}));return _generateAppleIconAsync.apply(this,arguments);}exports.generateAppleIconAsync=generateAppleIconAsync;function generateChromeIconAsync(_x9,_x10,_x11){return _generateChromeIconAsync.apply(this,arguments);}function _generateChromeIconAsync(){_generateChromeIconAsync=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(_ref4,icon,_ref5){var projectRoot,publicPath,_ref5$sizes,sizes,cacheType,data;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:projectRoot=_ref4.projectRoot,publicPath=_ref4.publicPath;_ref5$sizes=_ref5.sizes,sizes=_ref5$sizes===void 0?[144,192,512]:_ref5$sizes;cacheType='chrome-icon';_context7.next=5;return Promise.all(sizes.map(/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(size){var rel,_yield$Image$generate3,source,name,href;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:rel='chrome-icon';_context6.next=3;return Image.generateImageAsync({projectRoot:projectRoot,cacheType:cacheType},_objectSpread(_objectSpread({},icon),{},{width:size,height:size,name:\"\".concat(rel,\"-\").concat(size,\".png\")}));case 3:_yield$Image$generate3=_context6.sent;source=_yield$Image$generate3.source;name=_yield$Image$generate3.name;href=\"pwa/\".concat(rel,\"/\").concat(name);return _context6.abrupt(\"return\",{asset:{source:source,path:href},manifest:{src:joinUrlPath(publicPath,href),sizes:\"\".concat(size,\"x\").concat(size),type:'image/png'}});case 8:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x19){return _ref10.apply(this,arguments);};}()));case 5:data=_context7.sent;if(sizes.length){_context7.next=9;break;}_context7.next=9;return Image.Cache.clearUnusedCachesAsync(projectRoot,cacheType);case 9:return _context7.abrupt(\"return\",data);case 10:case\"end\":return _context7.stop();}}},_callee7);}));return _generateChromeIconAsync.apply(this,arguments);}exports.generateChromeIconAsync=generateChromeIconAsync;function generateFaviconAsync(_x12,_x13){return _generateFaviconAsync.apply(this,arguments);}function _generateFaviconAsync(){_generateFaviconAsync=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(_ref6,icon){var projectRoot,publicPath,cacheType,dimensions,data,faviconUrl,largestImageBuffer,faviconBuffer;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:projectRoot=_ref6.projectRoot,publicPath=_ref6.publicPath;cacheType='favicon';dimensions=[16,32,48];_context9.next=5;return Promise.all(dimensions.map(/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(size){var rel,_yield$Image$generate4,source,name,href;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:rel='icon';_context8.next=3;return Image.generateImageAsync({projectRoot:projectRoot,cacheType:cacheType},_objectSpread(_objectSpread({},icon),{},{backgroundColor:icon.backgroundColor||'transparent',width:size,height:size,name:\"favicon-\".concat(size,\".png\")}));case 3:_yield$Image$generate4=_context8.sent;source=_yield$Image$generate4.source;name=_yield$Image$generate4.name;href=\"\".concat(name);return _context8.abrupt(\"return\",{asset:{source:source,path:href},tag:{tagName:'link',attributes:{rel:rel,type:'image/png',sizes:\"\".concat(size,\"x\").concat(size),href:joinUrlPath(publicPath,href)}}});case 8:case\"end\":return _context8.stop();}}},_callee8);}));return function(_x20){return _ref11.apply(this,arguments);};}()));case 5:data=_context9.sent;faviconUrl=joinUrlPath(publicPath,'favicon.ico');largestImageBuffer=data[data.length-1].asset.source;_context9.next=10;return Image.generateFaviconAsync(largestImageBuffer,dimensions);case 10:faviconBuffer=_context9.sent;_context9.next=13;return Image.Cache.clearUnusedCachesAsync(projectRoot,cacheType);case 13:return _context9.abrupt(\"return\",[data[0],data[1],{asset:{source:faviconBuffer,path:'favicon.ico'},tag:{tagName:'link',attributes:{rel:'shortcut icon',href:faviconUrl}}}]);case 14:case\"end\":return _context9.stop();}}},_callee9);}));return _generateFaviconAsync.apply(this,arguments);}exports.generateFaviconAsync=generateFaviconAsync;function generateManifestAsync(_x14,_x15,_x16){return _generateManifestAsync.apply(this,arguments);}function _generateManifestAsync(){_generateManifestAsync=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(options,configPath,config){var manifest;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:if(configPath){(0,config_1.setCustomConfigPath)(options.projectRoot,configPath);}manifest=generateManifestJson(options,config);return _context10.abrupt(\"return\",[{// TODO: Bacon: Make the types more flexible\nasset:{source:JSON.stringify(manifest,null,2),path:'manifest.json'},tag:{tagName:'link',attributes:{rel:'manifest',href:joinUrlPath(options.publicPath,'manifest.json')}}}]);case 3:case\"end\":return _context10.stop();}}},_callee10);}));return _generateManifestAsync.apply(this,arguments);}exports.generateManifestAsync=generateManifestAsync;function generateManifestJson(_ref7,config){var projectRoot=_ref7.projectRoot;if(!config){if(!projectRoot)throw new Error('You must either define projectRoot or config');config=(0,Manifest_1.getConfigForPWA)(projectRoot);}return(0,Manifest_1.createPWAManifestFromWebConfig)(config.web);}exports.generateManifestJson=generateManifestJson;var Manifest_2=require(\"./Manifest\");Object.defineProperty(exports,\"getSafariStartupImageConfig\",{enumerable:true,get:function get(){return Manifest_2.getSafariStartupImageConfig;}});Object.defineProperty(exports,\"getSafariIconConfig\",{enumerable:true,get:function get(){return Manifest_2.getSafariIconConfig;}});Object.defineProperty(exports,\"getFaviconIconConfig\",{enumerable:true,get:function get(){return Manifest_2.getFaviconIconConfig;}});Object.defineProperty(exports,\"getChromeIconConfig\",{enumerable:true,get:function get(){return Manifest_2.getChromeIconConfig;}});","map":{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { ExpoConfig, setCustomConfigPath } from '@expo/config';\nimport * as Image from '@expo/image-utils';\nimport * as path from 'path';\nimport { URL } from 'url';\n\nimport { createPWAManifestFromWebConfig, getConfigForPWA } from './Manifest';\nimport { HTMLOutput, IconOptions, Manifest, ProjectOptions, SplashIcon } from './Manifest.types';\nimport { assembleOrientationMedia, getDevices } from './Splash';\n\n/**\n * Joins a url protocol + host to path segments, falls back to path.join\n * if result is not a valid url.\n */\nexport function joinUrlPath(publicPath: string, ...toJoin: string[]): string {\n  const segments = path.join(...toJoin);\n  try {\n    // Throws if publicPath is not a valid protocol+host\n    return new URL(segments, publicPath).href;\n  } catch {\n    return path.join(publicPath, segments);\n  }\n}\n\nexport async function generateAsync(\n  type: string,\n  options: ProjectOptions,\n  icon: IconOptions\n): Promise<HTMLOutput[]> {\n  switch (type) {\n    case 'splash':\n      return generateSplashAsync(options, icon);\n    case 'safari-icon':\n      return generateAppleIconAsync(options, icon, {});\n    case 'chrome-icon':\n      return generateChromeIconAsync(options, icon, {});\n    case 'favicon':\n      return generateFaviconAsync(options, icon);\n  }\n  throw new Error(`Invalid command type: ${type}`);\n}\n\nexport async function generateSplashAsync(\n  { projectRoot, publicPath }: ProjectOptions,\n  icon: IconOptions\n): Promise<HTMLOutput[]> {\n  const cacheType = 'apple-touch-startup-image';\n\n  // You cannot lock iOS PWA orientation, we should produce every splash screen\n  // orientation. We don't however because in iOS 13 it's far more rare to see landscape splash screens.\n  const devices = getDevices();\n\n  const icons: SplashIcon[] = Array.isArray(icon) ? icon : [];\n  if (!Array.isArray(icon)) {\n    for (const device of devices) {\n      for (const orientation of device.orientations) {\n        let width = 0;\n        let height = 0;\n        if (orientation !== 'portrait') {\n          width = device.height;\n          height = device.width;\n        } else {\n          height = device.height;\n          width = device.width;\n        }\n\n        const name = `apple-touch-startup-image-${width}x${height}.png`;\n        icons.push({\n          ...icon,\n          name,\n          width,\n          height,\n          media: assembleOrientationMedia(device.width, device.height, device.scale, orientation),\n        });\n      }\n    }\n  }\n\n  const data = await Promise.all<HTMLOutput>(\n    icons.map(\n      async (icon: SplashIcon): Promise<HTMLOutput> => {\n        // Ensure the default `splash.resizeMode` is used here:\n        // https://docs.expo.dev/versions/latest/config/app/#splash\n        if (!icon.resizeMode) {\n          icon.resizeMode = 'contain';\n        }\n        const { source, name } = await Image.generateImageAsync({ projectRoot, cacheType }, icon);\n\n        const href = `pwa/apple-touch-startup-image/${name}`;\n\n        return {\n          asset: {\n            source,\n            path: href,\n          },\n          tag: {\n            tagName: 'link',\n            attributes: {\n              rel: 'apple-touch-startup-image',\n              media: icon.media,\n              // TODO(Bacon): Use sizes to query splash screens better\n              // sizes: `${icon.width}x${icon.height}`,\n              href: joinUrlPath(publicPath, href),\n            },\n          },\n        };\n      }\n    )\n  );\n\n  await Image.Cache.clearUnusedCachesAsync(projectRoot, cacheType);\n\n  return data;\n}\n\nexport async function generateAppleIconAsync(\n  { projectRoot, publicPath }: ProjectOptions,\n  icon: IconOptions,\n  { sizes = [180] }: { sizes?: number[] }\n): Promise<HTMLOutput[]> {\n  const cacheType = 'apple-touch-icon';\n\n  const data = await Promise.all<HTMLOutput>(\n    sizes.map(\n      async (size: number): Promise<HTMLOutput> => {\n        const rel = 'apple-touch-icon';\n        const { source, name } = await Image.generateImageAsync(\n          { projectRoot, cacheType },\n          { ...icon, width: size, height: size, name: `${rel}-${size}.png` }\n        );\n\n        const href = `pwa/${rel}/${name}`;\n\n        return {\n          asset: {\n            source,\n            path: href,\n          },\n          tag: {\n            tagName: 'link',\n            attributes: {\n              rel,\n              sizes: `${size}x${size}`,\n              href: joinUrlPath(publicPath, href),\n            },\n          },\n        };\n      }\n    )\n  );\n\n  // Don't clear the caches if no generation was performed.\n  if (!sizes.length) {\n    await Image.Cache.clearUnusedCachesAsync(projectRoot, cacheType);\n  }\n\n  return data;\n}\n\nexport async function generateChromeIconAsync(\n  { projectRoot, publicPath }: ProjectOptions,\n  icon: IconOptions,\n  { sizes = [144, 192, 512] }: { sizes?: number[] }\n): Promise<HTMLOutput[]> {\n  const cacheType = 'chrome-icon';\n\n  const data = await Promise.all<HTMLOutput>(\n    sizes.map(\n      async (size: number): Promise<HTMLOutput> => {\n        const rel = 'chrome-icon';\n        const { source, name } = await Image.generateImageAsync(\n          { projectRoot, cacheType },\n          { ...icon, width: size, height: size, name: `${rel}-${size}.png` }\n        );\n\n        const href = `pwa/${rel}/${name}`;\n\n        return {\n          asset: {\n            source,\n            path: href,\n          },\n          manifest: {\n            src: joinUrlPath(publicPath, href),\n            sizes: `${size}x${size}`,\n            type: 'image/png',\n          },\n        };\n      }\n    )\n  );\n\n  // Don't clear the caches if no generation was performed.\n  if (!sizes.length) {\n    await Image.Cache.clearUnusedCachesAsync(projectRoot, cacheType);\n  }\n\n  return data;\n}\n\nexport async function generateFaviconAsync(\n  { projectRoot, publicPath }: ProjectOptions,\n  icon: IconOptions\n): Promise<HTMLOutput[]> {\n  const cacheType = 'favicon';\n  const dimensions = [16, 32, 48];\n  const data: HTMLOutput[] = await Promise.all<HTMLOutput>(\n    dimensions.map(\n      async (size: number): Promise<HTMLOutput> => {\n        const rel = 'icon';\n        const { source, name } = await Image.generateImageAsync(\n          { projectRoot, cacheType },\n          {\n            ...icon,\n            backgroundColor: icon.backgroundColor || 'transparent',\n            width: size,\n            height: size,\n            name: `favicon-${size}.png`,\n          }\n        );\n\n        const href = `${name}`;\n\n        return {\n          asset: {\n            source,\n            path: href,\n          },\n          tag: {\n            tagName: 'link',\n            attributes: {\n              rel,\n              type: 'image/png',\n              sizes: `${size}x${size}`,\n              href: joinUrlPath(publicPath, href),\n            },\n          },\n        };\n      }\n    )\n  );\n\n  const faviconUrl = joinUrlPath(publicPath, 'favicon.ico');\n\n  const largestImageBuffer = data[data.length - 1].asset.source;\n\n  const faviconBuffer = await Image.generateFaviconAsync(largestImageBuffer, dimensions);\n\n  await Image.Cache.clearUnusedCachesAsync(projectRoot, cacheType);\n\n  return [\n    data[0],\n    data[1],\n    {\n      asset: { source: faviconBuffer, path: 'favicon.ico' },\n      tag: {\n        tagName: 'link',\n        attributes: { rel: 'shortcut icon', href: faviconUrl },\n      },\n    },\n  ];\n}\n\nexport async function generateManifestAsync(\n  options: ProjectOptions,\n  configPath?: string,\n  config?: ExpoConfig\n): Promise<HTMLOutput[]> {\n  if (configPath) {\n    setCustomConfigPath(options.projectRoot, configPath);\n  }\n  const manifest = generateManifestJson(options, config);\n  return [\n    {\n      // TODO: Bacon: Make the types more flexible\n      asset: { source: JSON.stringify(manifest, null, 2) as any, path: 'manifest.json' },\n      tag: {\n        tagName: 'link',\n        attributes: { rel: 'manifest', href: joinUrlPath(options.publicPath, 'manifest.json') },\n      },\n    },\n  ];\n}\n\nexport function generateManifestJson(\n  { projectRoot }: Partial<ProjectOptions>,\n  config?: ExpoConfig\n): Manifest {\n  if (!config) {\n    if (!projectRoot) throw new Error('You must either define projectRoot or config');\n    config = getConfigForPWA(projectRoot);\n  }\n  return createPWAManifestFromWebConfig(config.web);\n}\n\nexport { getConfigForPWA };\nexport {\n  getSafariStartupImageConfig,\n  getSafariIconConfig,\n  getFaviconIconConfig,\n  getChromeIconConfig,\n} from './Manifest';\n\nexport { IconOptions, ProjectOptions, HTMLOutput, PWAConfig } from './Manifest.types';\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}