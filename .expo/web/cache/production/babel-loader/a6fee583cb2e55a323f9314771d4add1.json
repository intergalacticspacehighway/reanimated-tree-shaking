{"ast":null,"code":"\"use strict\";var _toConsumableArray=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/toConsumableArray\");var _defineProperty=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/defineProperty\");var _regeneratorRuntime=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/regenerator\");var _asyncToGenerator=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/asyncToGenerator\");var _classCallCheck=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/classCallCheck\");var _createClass=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/createClass\");function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||(\"get\"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function get(){return m[k];}};}Object.defineProperty(o,k2,desc);}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k];});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,\"default\",{enumerable:true,value:v});}:function(o,v){o[\"default\"]=v;});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod){if(k!==\"default\"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);}__setModuleDefault(result,mod);return result;};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{\"default\":mod};};Object.defineProperty(exports,\"__esModule\",{value:true});var code_frame_1=require(\"@babel/code-frame\");var fs_1=__importDefault(require(\"fs\"));var json5_1=__importDefault(require(\"json5\"));var path_1=__importDefault(require(\"path\"));var util_1=require(\"util\");var write_file_atomic_1=__importDefault(require(\"write-file-atomic\"));var JsonFileError_1=__importStar(require(\"./JsonFileError\"));var writeFileAtomicAsync=(0,util_1.promisify)(write_file_atomic_1[\"default\"]);var DEFAULT_OPTIONS={badJsonDefault:undefined,jsonParseErrorDefault:undefined,cantReadFileDefault:undefined,ensureDir:false,\"default\":undefined,json5:false,space:2,addNewLineAtEOF:true};/**\n * The JsonFile class represents the contents of json file.\n *\n * It's polymorphic on \"JSONObject\", which is a simple type representing\n * and object with string keys and either objects or primitive types as values.\n * @type {[type]}\n */var JsonFile=/*#__PURE__*/function(){function JsonFile(file){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,JsonFile);this.file=file;this.options=options;}_createClass(JsonFile,[{key:\"read\",value:function read(options){return _read(this.file,this._getOptions(options));}},{key:\"readAsync\",value:function(){var _readAsync2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(options){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",_readAsync(this.file,this._getOptions(options)));case 1:case\"end\":return _context.stop();}}},_callee,this);}));function readAsync(_x){return _readAsync2.apply(this,arguments);}return readAsync;}()},{key:\"writeAsync\",value:function(){var _writeAsync2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(object,options){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",_writeAsync(this.file,object,this._getOptions(options)));case 1:case\"end\":return _context2.stop();}}},_callee2,this);}));function writeAsync(_x2,_x3){return _writeAsync2.apply(this,arguments);}return writeAsync;}()},{key:\"parseJsonString\",value:function parseJsonString(json,options){return _parseJsonString(json,options);}},{key:\"getAsync\",value:function(){var _getAsync2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(key,defaultValue,options){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",_getAsync(this.file,key,defaultValue,this._getOptions(options)));case 1:case\"end\":return _context3.stop();}}},_callee3,this);}));function getAsync(_x4,_x5,_x6){return _getAsync2.apply(this,arguments);}return getAsync;}()},{key:\"setAsync\",value:function(){var _setAsync2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(key,value,options){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",_setAsync(this.file,key,value,this._getOptions(options)));case 1:case\"end\":return _context4.stop();}}},_callee4,this);}));function setAsync(_x7,_x8,_x9){return _setAsync2.apply(this,arguments);}return setAsync;}()},{key:\"mergeAsync\",value:function(){var _mergeAsync2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(sources,options){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt(\"return\",_mergeAsync(this.file,sources,this._getOptions(options)));case 1:case\"end\":return _context5.stop();}}},_callee5,this);}));function mergeAsync(_x10,_x11){return _mergeAsync2.apply(this,arguments);}return mergeAsync;}()},{key:\"deleteKeyAsync\",value:function(){var _deleteKeyAsync2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(key,options){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:return _context6.abrupt(\"return\",_deleteKeyAsync(this.file,key,this._getOptions(options)));case 1:case\"end\":return _context6.stop();}}},_callee6,this);}));function deleteKeyAsync(_x12,_x13){return _deleteKeyAsync2.apply(this,arguments);}return deleteKeyAsync;}()},{key:\"deleteKeysAsync\",value:function(){var _deleteKeysAsync2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(keys,options){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:return _context7.abrupt(\"return\",_deleteKeysAsync(this.file,keys,this._getOptions(options)));case 1:case\"end\":return _context7.stop();}}},_callee7,this);}));function deleteKeysAsync(_x14,_x15){return _deleteKeysAsync2.apply(this,arguments);}return deleteKeysAsync;}()},{key:\"rewriteAsync\",value:function(){var _rewriteAsync2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(options){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:return _context8.abrupt(\"return\",_rewriteAsync(this.file,this._getOptions(options)));case 1:case\"end\":return _context8.stop();}}},_callee8,this);}));function rewriteAsync(_x16){return _rewriteAsync2.apply(this,arguments);}return rewriteAsync;}()},{key:\"_getOptions\",value:function _getOptions(options){return _objectSpread(_objectSpread({},this.options),options);}}]);return JsonFile;}();exports[\"default\"]=JsonFile;JsonFile.read=_read;JsonFile.readAsync=_readAsync;JsonFile.parseJsonString=_parseJsonString;JsonFile.writeAsync=_writeAsync;JsonFile.getAsync=_getAsync;JsonFile.setAsync=_setAsync;JsonFile.mergeAsync=_mergeAsync;JsonFile.deleteKeyAsync=_deleteKeyAsync;JsonFile.deleteKeysAsync=_deleteKeysAsync;JsonFile.rewriteAsync=_rewriteAsync;function _read(file,options){var json;try{json=fs_1[\"default\"].readFileSync(file,'utf8');}catch(error){assertEmptyJsonString(json,file);var defaultValue=cantReadFileDefault(options);if(defaultValue===undefined){throw new JsonFileError_1[\"default\"](\"Can't read JSON file: \".concat(file),error,error.code,file);}else{return defaultValue;}}return _parseJsonString(json,options,file);}function _readAsync(_x17,_x18){return _readAsync3.apply(this,arguments);}function _readAsync3(){_readAsync3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(file,options){var json,defaultValue;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.prev=0;_context9.next=3;return fs_1[\"default\"].promises.readFile(file,'utf8');case 3:json=_context9.sent;_context9.next=15;break;case 6:_context9.prev=6;_context9.t0=_context9[\"catch\"](0);assertEmptyJsonString(json,file);defaultValue=cantReadFileDefault(options);if(!(defaultValue===undefined)){_context9.next=14;break;}throw new JsonFileError_1[\"default\"](\"Can't read JSON file: \".concat(file),_context9.t0,_context9.t0.code);case 14:return _context9.abrupt(\"return\",defaultValue);case 15:return _context9.abrupt(\"return\",_parseJsonString(json,options));case 16:case\"end\":return _context9.stop();}}},_callee9,null,[[0,6]]);}));return _readAsync3.apply(this,arguments);}function _parseJsonString(json,options,fileName){assertEmptyJsonString(json,fileName);try{if(_getOption(options,'json5')){return json5_1[\"default\"].parse(json);}else{return JSON.parse(json);}}catch(e){var defaultValue=jsonParseErrorDefault(options);if(defaultValue===undefined){var location=locationFromSyntaxError(e,json);if(location){var codeFrame=(0,code_frame_1.codeFrameColumns)(json,{start:location});e.codeFrame=codeFrame;e.message+=\"\\n\".concat(codeFrame);}throw new JsonFileError_1[\"default\"](\"Error parsing JSON: \".concat(json),e,'EJSONPARSE',fileName);}else{return defaultValue;}}}function _getAsync(_x19,_x20,_x21,_x22){return _getAsync3.apply(this,arguments);}function _getAsync3(){_getAsync3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(file,key,defaultValue,options){var object;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return _readAsync(file,options);case 2:object=_context10.sent;if(!(key in object)){_context10.next=5;break;}return _context10.abrupt(\"return\",object[key]);case 5:if(!(defaultValue===undefined)){_context10.next=7;break;}throw new JsonFileError_1[\"default\"](\"No value at key path \\\"\".concat(key,\"\\\" in JSON object from: \").concat(file));case 7:return _context10.abrupt(\"return\",defaultValue);case 8:case\"end\":return _context10.stop();}}},_callee10);}));return _getAsync3.apply(this,arguments);}function _writeAsync(_x23,_x24,_x25){return _writeAsync3.apply(this,arguments);}function _writeAsync3(){_writeAsync3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(file,object,options){var space,json5,addNewLineAtEOF,json,data;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:if(!(options===null||options===void 0?void 0:options.ensureDir)){_context11.next=3;break;}_context11.next=3;return fs_1[\"default\"].promises.mkdir(path_1[\"default\"].dirname(file),{recursive:true});case 3:space=_getOption(options,'space');json5=_getOption(options,'json5');addNewLineAtEOF=_getOption(options,'addNewLineAtEOF');_context11.prev=6;if(json5){json=json5_1[\"default\"].stringify(object,null,space);}else{json=JSON.stringify(object,null,space);}_context11.next=13;break;case 10:_context11.prev=10;_context11.t0=_context11[\"catch\"](6);throw new JsonFileError_1[\"default\"](\"Couldn't JSON.stringify object for file: \".concat(file),_context11.t0);case 13:data=addNewLineAtEOF?\"\".concat(json,\"\\n\"):json;_context11.next=16;return writeFileAtomicAsync(file,data,{});case 16:return _context11.abrupt(\"return\",object);case 17:case\"end\":return _context11.stop();}}},_callee11,null,[[6,10]]);}));return _writeAsync3.apply(this,arguments);}function _setAsync(_x26,_x27,_x28,_x29){return _setAsync3.apply(this,arguments);}function _setAsync3(){_setAsync3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(file,key,value,options){var object;return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.next=2;return _readAsync(file,options);case 2:object=_context12.sent;return _context12.abrupt(\"return\",_writeAsync(file,_objectSpread(_objectSpread({},object),{},_defineProperty({},key,value)),options));case 4:case\"end\":return _context12.stop();}}},_callee12);}));return _setAsync3.apply(this,arguments);}function _mergeAsync(_x30,_x31,_x32){return _mergeAsync3.apply(this,arguments);}function _mergeAsync3(){_mergeAsync3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee13(file,sources,options){var object;return _regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:_context13.next=2;return _readAsync(file,options);case 2:object=_context13.sent;if(Array.isArray(sources)){Object.assign.apply(Object,[object].concat(_toConsumableArray(sources)));}else{Object.assign(object,sources);}return _context13.abrupt(\"return\",_writeAsync(file,object,options));case 5:case\"end\":return _context13.stop();}}},_callee13);}));return _mergeAsync3.apply(this,arguments);}function _deleteKeyAsync(_x33,_x34,_x35){return _deleteKeyAsync3.apply(this,arguments);}function _deleteKeyAsync3(){_deleteKeyAsync3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee14(file,key,options){return _regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:return _context14.abrupt(\"return\",_deleteKeysAsync(file,[key],options));case 1:case\"end\":return _context14.stop();}}},_callee14);}));return _deleteKeyAsync3.apply(this,arguments);}function _deleteKeysAsync(_x36,_x37,_x38){return _deleteKeysAsync3.apply(this,arguments);}function _deleteKeysAsync3(){_deleteKeysAsync3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee15(file,keys,options){var object,didDelete,i,key;return _regeneratorRuntime.wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:_context15.next=2;return _readAsync(file,options);case 2:object=_context15.sent;didDelete=false;for(i=0;i<keys.length;i++){key=keys[i];if(object.hasOwnProperty(key)){delete object[key];didDelete=true;}}if(!didDelete){_context15.next=7;break;}return _context15.abrupt(\"return\",_writeAsync(file,object,options));case 7:return _context15.abrupt(\"return\",object);case 8:case\"end\":return _context15.stop();}}},_callee15);}));return _deleteKeysAsync3.apply(this,arguments);}function _rewriteAsync(_x39,_x40){return _rewriteAsync3.apply(this,arguments);}function _rewriteAsync3(){_rewriteAsync3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee16(file,options){var object;return _regeneratorRuntime.wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:_context16.next=2;return _readAsync(file,options);case 2:object=_context16.sent;return _context16.abrupt(\"return\",_writeAsync(file,object,options));case 4:case\"end\":return _context16.stop();}}},_callee16);}));return _rewriteAsync3.apply(this,arguments);}function jsonParseErrorDefault(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(options.jsonParseErrorDefault===undefined){return options[\"default\"];}else{return options.jsonParseErrorDefault;}}function cantReadFileDefault(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(options.cantReadFileDefault===undefined){return options[\"default\"];}else{return options.cantReadFileDefault;}}function _getOption(options,field){if(options){if(options[field]!==undefined){return options[field];}}return DEFAULT_OPTIONS[field];}function locationFromSyntaxError(error,sourceString){// JSON5 SyntaxError has lineNumber and columnNumber.\nif('lineNumber'in error&&'columnNumber'in error){return{line:error.lineNumber,column:error.columnNumber};}// JSON SyntaxError only includes the index in the message.\nvar match=/at position (\\d+)/.exec(error.message);if(match){var index=parseInt(match[1],10);var lines=sourceString.slice(0,index+1).split('\\n');return{line:lines.length,column:lines[lines.length-1].length};}return null;}function assertEmptyJsonString(json,file){if((json===null||json===void 0?void 0:json.trim())===''){throw new JsonFileError_1.EmptyJsonFileError(file);}}","map":{"version":3,"sources":["../src/JsonFile.ts"],"names":[],"mappings":"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","sourcesContent":["import { codeFrameColumns } from '@babel/code-frame';\nimport fs from 'fs';\nimport JSON5 from 'json5';\nimport path from 'path';\nimport { promisify } from 'util';\nimport writeFileAtomic from 'write-file-atomic';\n\nimport JsonFileError, { EmptyJsonFileError } from './JsonFileError';\n\nconst writeFileAtomicAsync: (\n  filename: string,\n  data: string | Buffer,\n  options: writeFileAtomic.Options\n) => void = promisify(writeFileAtomic);\n\nexport type JSONValue = boolean | number | string | null | JSONArray | JSONObject;\nexport interface JSONArray extends Array<JSONValue> {}\nexport interface JSONObject {\n  [key: string]: JSONValue | undefined;\n}\n\ntype Defined<T> = T extends undefined ? never : T;\n\ntype Options<TJSONObject extends JSONObject> = {\n  badJsonDefault?: TJSONObject;\n  jsonParseErrorDefault?: TJSONObject;\n  cantReadFileDefault?: TJSONObject;\n  ensureDir?: boolean;\n  default?: TJSONObject;\n  json5?: boolean;\n  space?: number;\n  addNewLineAtEOF?: boolean;\n};\n\nconst DEFAULT_OPTIONS = {\n  badJsonDefault: undefined,\n  jsonParseErrorDefault: undefined,\n  cantReadFileDefault: undefined,\n  ensureDir: false,\n  default: undefined,\n  json5: false,\n  space: 2,\n  addNewLineAtEOF: true,\n};\n\n/**\n * The JsonFile class represents the contents of json file.\n *\n * It's polymorphic on \"JSONObject\", which is a simple type representing\n * and object with string keys and either objects or primitive types as values.\n * @type {[type]}\n */\nexport default class JsonFile<TJSONObject extends JSONObject> {\n  file: string;\n  options: Options<TJSONObject>;\n\n  static read = read;\n  static readAsync = readAsync;\n  static parseJsonString = parseJsonString;\n  static writeAsync = writeAsync;\n  static getAsync = getAsync;\n  static setAsync = setAsync;\n  static mergeAsync = mergeAsync;\n  static deleteKeyAsync = deleteKeyAsync;\n  static deleteKeysAsync = deleteKeysAsync;\n  static rewriteAsync = rewriteAsync;\n\n  constructor(file: string, options: Options<TJSONObject> = {}) {\n    this.file = file;\n    this.options = options;\n  }\n\n  read(options?: Options<TJSONObject>): TJSONObject {\n    return read(this.file, this._getOptions(options));\n  }\n\n  async readAsync(options?: Options<TJSONObject>): Promise<TJSONObject> {\n    return readAsync(this.file, this._getOptions(options));\n  }\n\n  async writeAsync(object: TJSONObject, options?: Options<TJSONObject>) {\n    return writeAsync(this.file, object, this._getOptions(options));\n  }\n\n  parseJsonString(json: string, options?: Options<TJSONObject>): TJSONObject {\n    return parseJsonString(json, options);\n  }\n\n  async getAsync<K extends keyof TJSONObject, TDefault extends TJSONObject[K] | null>(\n    key: K,\n    defaultValue: TDefault,\n    options?: Options<TJSONObject>\n  ): Promise<Defined<TJSONObject[K]> | TDefault> {\n    return getAsync(this.file, key, defaultValue, this._getOptions(options));\n  }\n\n  async setAsync(key: string, value: unknown, options?: Options<TJSONObject>) {\n    return setAsync(this.file, key, value, this._getOptions(options));\n  }\n\n  async mergeAsync(\n    sources: Partial<TJSONObject> | Partial<TJSONObject>[],\n    options?: Options<TJSONObject>\n  ): Promise<TJSONObject> {\n    return mergeAsync<TJSONObject>(this.file, sources, this._getOptions(options));\n  }\n\n  async deleteKeyAsync(key: string, options?: Options<TJSONObject>) {\n    return deleteKeyAsync(this.file, key, this._getOptions(options));\n  }\n\n  async deleteKeysAsync(keys: string[], options?: Options<TJSONObject>) {\n    return deleteKeysAsync(this.file, keys, this._getOptions(options));\n  }\n\n  async rewriteAsync(options?: Options<TJSONObject>) {\n    return rewriteAsync(this.file, this._getOptions(options));\n  }\n\n  _getOptions(options?: Options<TJSONObject>): Options<TJSONObject> {\n    return {\n      ...this.options,\n      ...options,\n    };\n  }\n}\n\nfunction read<TJSONObject extends JSONObject>(\n  file: string,\n  options?: Options<TJSONObject>\n): TJSONObject {\n  let json;\n  try {\n    json = fs.readFileSync(file, 'utf8');\n  } catch (error: any) {\n    assertEmptyJsonString(json, file);\n    const defaultValue = cantReadFileDefault(options);\n    if (defaultValue === undefined) {\n      throw new JsonFileError(`Can't read JSON file: ${file}`, error, error.code, file);\n    } else {\n      return defaultValue;\n    }\n  }\n  return parseJsonString(json, options, file);\n}\n\nasync function readAsync<TJSONObject extends JSONObject>(\n  file: string,\n  options?: Options<TJSONObject>\n): Promise<TJSONObject> {\n  let json;\n  try {\n    json = await fs.promises.readFile(file, 'utf8');\n  } catch (error: any) {\n    assertEmptyJsonString(json, file);\n    const defaultValue = cantReadFileDefault(options);\n    if (defaultValue === undefined) {\n      throw new JsonFileError(`Can't read JSON file: ${file}`, error, error.code);\n    } else {\n      return defaultValue;\n    }\n  }\n  return parseJsonString(json, options);\n}\n\nfunction parseJsonString<TJSONObject extends JSONObject>(\n  json: string,\n  options?: Options<TJSONObject>,\n  fileName?: string\n): TJSONObject {\n  assertEmptyJsonString(json, fileName);\n  try {\n    if (_getOption(options, 'json5')) {\n      return JSON5.parse(json);\n    } else {\n      return JSON.parse(json);\n    }\n  } catch (e: any) {\n    const defaultValue = jsonParseErrorDefault(options);\n    if (defaultValue === undefined) {\n      const location = locationFromSyntaxError(e, json);\n      if (location) {\n        const codeFrame = codeFrameColumns(json, { start: location });\n        e.codeFrame = codeFrame;\n        e.message += `\\n${codeFrame}`;\n      }\n      throw new JsonFileError(`Error parsing JSON: ${json}`, e, 'EJSONPARSE', fileName);\n    } else {\n      return defaultValue;\n    }\n  }\n}\n\nasync function getAsync<TJSONObject extends JSONObject, K extends keyof TJSONObject, DefaultValue>(\n  file: string,\n  key: K,\n  defaultValue: DefaultValue,\n  options?: Options<TJSONObject>\n): Promise<any> {\n  const object = await readAsync(file, options);\n  if (key in object) {\n    return object[key];\n  }\n  if (defaultValue === undefined) {\n    throw new JsonFileError(`No value at key path \"${key}\" in JSON object from: ${file}`);\n  }\n  return defaultValue;\n}\n\nasync function writeAsync<TJSONObject extends JSONObject>(\n  file: string,\n  object: TJSONObject,\n  options?: Options<TJSONObject>\n): Promise<TJSONObject> {\n  if (options?.ensureDir) {\n    await fs.promises.mkdir(path.dirname(file), { recursive: true });\n  }\n  const space = _getOption(options, 'space');\n  const json5 = _getOption(options, 'json5');\n  const addNewLineAtEOF = _getOption(options, 'addNewLineAtEOF');\n  let json;\n  try {\n    if (json5) {\n      json = JSON5.stringify(object, null, space);\n    } else {\n      json = JSON.stringify(object, null, space);\n    }\n  } catch (e: any) {\n    throw new JsonFileError(`Couldn't JSON.stringify object for file: ${file}`, e);\n  }\n  const data = addNewLineAtEOF ? `${json}\\n` : json;\n  await writeFileAtomicAsync(file, data, {});\n  return object;\n}\n\nasync function setAsync<TJSONObject extends JSONObject>(\n  file: string,\n  key: string,\n  value: unknown,\n  options?: Options<TJSONObject>\n): Promise<TJSONObject> {\n  // TODO: Consider implementing some kind of locking mechanism, but\n  // it's not critical for our use case, so we'll leave it out for now\n  const object = await readAsync(file, options);\n  return writeAsync(file, { ...object, [key]: value }, options);\n}\n\nasync function mergeAsync<TJSONObject extends JSONObject>(\n  file: string,\n  sources: Partial<TJSONObject> | Partial<TJSONObject>[],\n  options?: Options<TJSONObject>\n): Promise<TJSONObject> {\n  const object = await readAsync(file, options);\n  if (Array.isArray(sources)) {\n    Object.assign(object, ...sources);\n  } else {\n    Object.assign(object, sources);\n  }\n  return writeAsync(file, object, options);\n}\n\nasync function deleteKeyAsync<TJSONObject extends JSONObject>(\n  file: string,\n  key: string,\n  options?: Options<TJSONObject>\n): Promise<TJSONObject> {\n  return deleteKeysAsync(file, [key], options);\n}\n\nasync function deleteKeysAsync<TJSONObject extends JSONObject>(\n  file: string,\n  keys: string[],\n  options?: Options<TJSONObject>\n): Promise<TJSONObject> {\n  const object = await readAsync(file, options);\n  let didDelete = false;\n\n  for (let i = 0; i < keys.length; i++) {\n    const key = keys[i];\n    if (object.hasOwnProperty(key)) {\n      delete object[key];\n      didDelete = true;\n    }\n  }\n\n  if (didDelete) {\n    return writeAsync(file, object, options);\n  }\n  return object;\n}\n\nasync function rewriteAsync<TJSONObject extends JSONObject>(\n  file: string,\n  options?: Options<TJSONObject>\n): Promise<TJSONObject> {\n  const object = await readAsync(file, options);\n  return writeAsync(file, object, options);\n}\n\nfunction jsonParseErrorDefault<TJSONObject extends JSONObject>(\n  options: Options<TJSONObject> = {}\n): TJSONObject | void {\n  if (options.jsonParseErrorDefault === undefined) {\n    return options.default;\n  } else {\n    return options.jsonParseErrorDefault;\n  }\n}\n\nfunction cantReadFileDefault<TJSONObject extends JSONObject>(\n  options: Options<TJSONObject> = {}\n): TJSONObject | void {\n  if (options.cantReadFileDefault === undefined) {\n    return options.default;\n  } else {\n    return options.cantReadFileDefault;\n  }\n}\n\nfunction _getOption<TJSONObject extends JSONObject, K extends keyof Options<TJSONObject>>(\n  options: Options<TJSONObject> | undefined,\n  field: K\n): Options<TJSONObject>[K] {\n  if (options) {\n    if (options[field] !== undefined) {\n      return options[field];\n    }\n  }\n  return DEFAULT_OPTIONS[field];\n}\n\nfunction locationFromSyntaxError(error: any, sourceString: string) {\n  // JSON5 SyntaxError has lineNumber and columnNumber.\n  if ('lineNumber' in error && 'columnNumber' in error) {\n    return { line: error.lineNumber, column: error.columnNumber };\n  }\n  // JSON SyntaxError only includes the index in the message.\n  const match = /at position (\\d+)/.exec(error.message);\n  if (match) {\n    const index = parseInt(match[1], 10);\n    const lines = sourceString.slice(0, index + 1).split('\\n');\n    return { line: lines.length, column: lines[lines.length - 1].length };\n  }\n\n  return null;\n}\n\nfunction assertEmptyJsonString(json?: string, file?: string) {\n  if (json?.trim() === '') {\n    throw new EmptyJsonFileError(file);\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}