{"ast":null,"code":"\"use strict\";var _regeneratorRuntime=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/regenerator\");var _asyncToGenerator=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/asyncToGenerator\");var _slicedToArray=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/slicedToArray\");var _defineProperty=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/defineProperty\");var _toConsumableArray=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/toConsumableArray\");function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!==\"undefined\"&&o[Symbol.iterator]||o[\"@@iterator\"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it[\"return\"]!=null)it[\"return\"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}Object.defineProperty(exports,\"__esModule\",{value:true});exports.resolveEntryAsync=exports.isEntry=exports.isRuleSetLoader=exports.isRuleSetItem=exports.getPluginsByName=exports.getPlugins=exports.conditionMatchesFile=exports.resolveRuleSetUse=exports.rulesMatchAnyFiles=exports.getRulesByMatchingFiles=exports.getLoaders=exports.getLoadersFromRules=exports.getRulesFromRules=exports.getExpoBabelLoader=exports.getRules=exports.getRulesAsItems=exports.findLoader=void 0;/**\n * Loader flattening inspired by:\n * https://github.com/preactjs/preact-cli-experiment/tree/7b80623/packages/cli-plugin-legacy-config\n */var util_1=require(\"util\");/**\n *\n * @param loaderName\n * @param rules\n * @category utils\n */function findLoader(loaderName,rules){var _iterator=_createForOfIteratorHelper(rules),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var rule=_step.value;if(rule.use&&rule.use.loader&&(rule.use.loader.includes(\"/\".concat(loaderName))||rule.use.loader.includes(\"\\\\\".concat(loaderName)))){return rule;}}}catch(err){_iterator.e(err);}finally{_iterator.f();}return null;}exports.findLoader=findLoader;/**\n *\n * @param rules\n * @category utils\n */function getRulesAsItems(rules){return rules.map(function(rule,index){return{index:index,rule:rule};});}exports.getRulesAsItems=getRulesAsItems;/**\n *\n * @param config\n * @category utils\n */function getRules(config){var _ref=config.module||{},_ref$rules=_ref.rules,rules=_ref$rules===void 0?[]:_ref$rules;return getRulesAsItems(getRulesFromRules(rules));}exports.getRules=getRules;/**\n * Get the babel-loader rule created by `@expo/webpack-config/loaders`\n *\n * @param config\n * @category utils\n */function getExpoBabelLoader(config){var _a,_b;var _ref2=config.module||{},_ref2$rules=_ref2.rules,rules=_ref2$rules===void 0?[]:_ref2$rules;var currentRules=getRulesAsItems(getRulesFromRules(rules));var _iterator2=_createForOfIteratorHelper(currentRules),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var ruleItem=_step2.value;var rule=ruleItem.rule;if(rule.use&&typeof rule.use==='object'&&((_b=(_a=rule.use.options)===null||_a===void 0?void 0:_a.caller)===null||_b===void 0?void 0:_b.__dangerous_rule_id)==='expo-babel-loader'){return rule;}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return null;}exports.getExpoBabelLoader=getExpoBabelLoader;/**\n *\n * @param rules\n * @category utils\n */function getRulesFromRules(rules){var output=[];var _iterator3=_createForOfIteratorHelper(rules),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var rule=_step3.value;if(rule.oneOf){output.push.apply(output,_toConsumableArray(getRulesFromRules(rule.oneOf)));}else{output.push(rule);}}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}return output;}exports.getRulesFromRules=getRulesFromRules;/**\n *\n * @param rules\n * @category utils\n */function getLoadersFromRules(rules){var loaders=rules.map(function(_ref3){var rule=_ref3.rule,ruleIndex=_ref3.index;if(rule.oneOf){return getLoadersFromRules(getRulesAsItems(rule.oneOf));}return loaderToLoaderItemLoaderPart(rule.loaders||rule.loader||rule.use).map(function(loader){return _objectSpread(_objectSpread({},loader),{},{rule:rule,ruleIndex:ruleIndex});});});return loaders.reduce(function(arr,a){return arr.concat(a);},[]);}exports.getLoadersFromRules=getLoadersFromRules;/**\n *\n * @param config\n * @category utils\n */function getLoaders(config){var rules=getRules(config);return getLoadersFromRules(rules);}exports.getLoaders=getLoaders;function loaderToLoaderItemLoaderPart(loader){if(!loader)return[];var loaders=[];if(typeof loader==='function'){loaders.push.apply(loaders,_toConsumableArray(loaderToLoaderItemLoaderPart(loader({}))));}else if(isRuleSetItem(loader)){loaders.push({loader:loader,loaderIndex:-1});}else if(Array.isArray(loader)){loaders.push.apply(loaders,_toConsumableArray(loader.map(function(loader,loaderIndex){return{loader:loader,loaderIndex:loaderIndex};})));}return loaders;}/**\n *\n * @param config\n * @param files\n * @category utils\n */function getRulesByMatchingFiles(config,files){var rules=getRules(config);var selectedRules={};var _iterator4=_createForOfIteratorHelper(files),_step4;try{var _loop=function _loop(){var file=_step4.value;selectedRules[file]=rules.filter(function(_ref4){var rule=_ref4.rule;return conditionMatchesFile(rule.test,file);});};for(_iterator4.s();!(_step4=_iterator4.n()).done;){_loop();}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}return selectedRules;}exports.getRulesByMatchingFiles=getRulesByMatchingFiles;/**\n *\n * @param config\n * @param files\n * @category utils\n */function rulesMatchAnyFiles(config,files){var rules=getRulesByMatchingFiles(config,files);return Object.keys(rules).some(function(filename){return!!rules[filename].length;});}exports.rulesMatchAnyFiles=rulesMatchAnyFiles;/**\n *\n * @param rule\n * @category utils\n */function resolveRuleSetUse(rule){if(!rule)return[];if(Array.isArray(rule)){var rules=rule;var resolved=[];var _iterator5=_createForOfIteratorHelper(rules),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var _rule=_step5.value;resolved=[].concat(_toConsumableArray(resolved),_toConsumableArray(resolveRuleSetUse(_rule)));}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}return resolved;}else if(typeof rule==='string'||isRuleSetLoader(rule)){return[rule];}else if(typeof rule==='function'){return resolveRuleSetUse(rule({}));}return[rule];}exports.resolveRuleSetUse=resolveRuleSetUse;/**\n *\n * @param condition\n * @param file\n * @category utils\n */function conditionMatchesFile(condition,file){if(!condition)return false;if((0,util_1.isRegExp)(condition)){return condition.test(file);}else if(typeof condition==='string'){return file.startsWith(condition);}else if(typeof condition==='function'){return Boolean(condition(file));}else if(Array.isArray(condition)){return condition.some(function(c){return conditionMatchesFile(c,file);});}return Object.entries(condition).map(function(_ref5){var _ref6=_slicedToArray(_ref5,2),key=_ref6[0],value=_ref6[1];switch(key){case'test':return conditionMatchesFile(value,file);case'include':return conditionMatchesFile(value,file);case'exclude':return!conditionMatchesFile(value,file);case'and':return value.every(function(c){return conditionMatchesFile(c,file);});case'or':return value.some(function(c){return conditionMatchesFile(c,file);});case'not':return value.every(function(c){return!conditionMatchesFile(c,file);});default:return true;}}).every(function(b){return b;});}exports.conditionMatchesFile=conditionMatchesFile;/**\n *\n * @param param0\n * @category utils\n */function getPlugins(_ref7){var _ref7$plugins=_ref7.plugins,plugins=_ref7$plugins===void 0?[]:_ref7$plugins;return plugins.map(function(plugin,index){return{index:index,plugin:plugin};});}exports.getPlugins=getPlugins;/**\n *\n * @param config\n * @param name\n * @category utils\n */function getPluginsByName(config,name){return getPlugins(config).filter(function(_ref8){var plugin=_ref8.plugin;if(plugin&&plugin.constructor){return plugin.constructor.name===name;}return false;});}exports.getPluginsByName=getPluginsByName;/**\n *\n * @param loader\n * @category utils\n */function isRuleSetItem(loader){return typeof loader==='string'||typeof loader==='function'||isRuleSetLoader(loader);}exports.isRuleSetItem=isRuleSetItem;/**\n *\n * @param loader\n * @category utils\n */function isRuleSetLoader(loader){return Object.keys(loader).some(function(k){return['loader','options','indent','query'].includes(k);});}exports.isRuleSetLoader=isRuleSetLoader;/**\n *\n * @param arg\n * @category utils\n */function isEntry(arg){if(typeof arg!=='object'||arg===null){return false;}return Object.values(arg).every(function(value){if(Array.isArray(value)){return value.every(function(value){return typeof value==='string';});}return typeof value==='string';});}exports.isEntry=isEntry;/**\n *\n * @param arg\n * @category utils\n */function resolveEntryAsync(_x){return _resolveEntryAsync.apply(this,arguments);}function _resolveEntryAsync(){_resolveEntryAsync=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(arg){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(typeof arg==='undefined')){_context.next=2;break;}throw new Error('Webpack config entry cannot be undefined');case 2:if(!(typeof arg==='function')){_context.next=10;break;}_context.t0=resolveEntryAsync;_context.next=6;return arg();case 6:_context.t1=_context.sent;return _context.abrupt(\"return\",(0,_context.t0)(_context.t1));case 10:if(!(typeof arg==='string')){_context.next=14;break;}return _context.abrupt(\"return\",resolveEntryAsync([arg]));case 14:if(!Array.isArray(arg)){_context.next=18;break;}return _context.abrupt(\"return\",{app:arg});case 18:if(!isEntry(arg)){_context.next=20;break;}return _context.abrupt(\"return\",arg);case 20:throw new Error('Cannot resolve Webpack config entry prop: '+arg);case 21:case\"end\":return _context.stop();}}},_callee);}));return _resolveEntryAsync.apply(this,arguments);}exports.resolveEntryAsync=resolveEntryAsync;","map":{"version":3,"sources":["../../src/utils/search.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Loader flattening inspired by:\n * https://github.com/preactjs/preact-cli-experiment/tree/7b80623/packages/cli-plugin-legacy-config\n */\nimport { isRegExp } from 'util';\nimport {\n  Configuration,\n  Entry,\n  Plugin,\n  Rule,\n  RuleSetCondition,\n  RuleSetLoader,\n  RuleSetRule,\n  RuleSetUse,\n  RuleSetUseItem,\n} from 'webpack';\n\nimport { DevConfiguration } from '../types';\n\ntype AnyConfiguration = Configuration | DevConfiguration;\n\ntype LoaderItemLoaderPart = Pick<LoaderItem, 'loader' | 'loaderIndex'>;\n\ninterface RuleItem {\n  rule: RuleSetRule;\n  index: number;\n}\n\ntype ResolvedRuleSet = string | RuleSetLoader;\n\ninterface PluginItem {\n  plugin: Plugin;\n  index: number;\n}\n\ninterface LoaderItem {\n  rule: RuleSetRule;\n  ruleIndex: number;\n  loader: RuleSetUseItem;\n  loaderIndex: number;\n}\n\n/**\n *\n * @param loaderName\n * @param rules\n * @category utils\n */\nexport function findLoader(loaderName: string, rules: RuleSetRule[]): RuleSetRule | null {\n  for (const rule of rules) {\n    if (\n      rule.use &&\n      (rule.use as any).loader &&\n      ((rule.use as RuleSetLoader).loader!.includes(`/${loaderName}`) ||\n        (rule.use as any).loader.includes(`\\\\${loaderName}`))\n    ) {\n      return rule;\n    }\n  }\n  return null;\n}\n\n/**\n *\n * @param rules\n * @category utils\n */\nexport function getRulesAsItems(rules: RuleSetRule[]): RuleItem[] {\n  return rules.map((rule, index) => ({\n    index,\n    rule,\n  }));\n}\n\n/**\n *\n * @param config\n * @category utils\n */\nexport function getRules(config: AnyConfiguration): RuleItem[] {\n  const { rules = [] } = config.module || {};\n  return getRulesAsItems(getRulesFromRules(rules));\n}\n\n/**\n * Get the babel-loader rule created by `@expo/webpack-config/loaders`\n *\n * @param config\n * @category utils\n */\nexport function getExpoBabelLoader(config: AnyConfiguration): Rule | null {\n  const { rules = [] } = config.module || {};\n  const currentRules = getRulesAsItems(getRulesFromRules(rules));\n  for (const ruleItem of currentRules) {\n    const rule: any = ruleItem.rule;\n    if (\n      rule.use &&\n      typeof rule.use === 'object' &&\n      rule.use.options?.caller?.__dangerous_rule_id === 'expo-babel-loader'\n    ) {\n      return rule;\n    }\n  }\n  return null;\n}\n\n/**\n *\n * @param rules\n * @category utils\n */\nexport function getRulesFromRules(rules: RuleSetRule[]): RuleSetRule[] {\n  const output: RuleSetRule[] = [];\n\n  for (const rule of rules) {\n    if (rule.oneOf) {\n      output.push(...getRulesFromRules(rule.oneOf));\n    } else {\n      output.push(rule);\n    }\n  }\n  return output;\n}\n\n/**\n *\n * @param rules\n * @category utils\n */\nexport function getLoadersFromRules(rules: RuleItem[]): LoaderItem[] {\n  const loaders = rules.map(({ rule, index: ruleIndex }) => {\n    if (rule.oneOf) {\n      return getLoadersFromRules(getRulesAsItems(rule.oneOf));\n    }\n    return loaderToLoaderItemLoaderPart(rule.loaders || rule.loader || rule.use).map(loader => ({\n      ...loader,\n      rule,\n      ruleIndex,\n    }));\n  });\n\n  return loaders.reduce((arr, a) => arr.concat(a), []);\n}\n\n/**\n *\n * @param config\n * @category utils\n */\nexport function getLoaders(config: AnyConfiguration): LoaderItem[] {\n  const rules = getRules(config);\n  return getLoadersFromRules(rules);\n}\n\nfunction loaderToLoaderItemLoaderPart(loader: RuleSetUse | undefined): LoaderItemLoaderPart[] {\n  if (!loader) return [];\n  const loaders: LoaderItemLoaderPart[] = [];\n  if (typeof loader === 'function') {\n    loaders.push(...loaderToLoaderItemLoaderPart(loader({})));\n  } else if (isRuleSetItem(loader)) {\n    loaders.push({ loader, loaderIndex: -1 });\n  } else if (Array.isArray(loader)) {\n    loaders.push(...loader.map((loader, loaderIndex) => ({ loader, loaderIndex })));\n  }\n  return loaders;\n}\n\n/**\n *\n * @param config\n * @param files\n * @category utils\n */\nexport function getRulesByMatchingFiles(\n  config: AnyConfiguration,\n  files: string[]\n): { [key: string]: RuleItem[] } {\n  const rules = getRules(config);\n  const selectedRules: { [key: string]: RuleItem[] } = {};\n  for (const file of files) {\n    selectedRules[file] = rules.filter(({ rule }) => conditionMatchesFile(rule.test, file));\n  }\n  return selectedRules;\n}\n\n/**\n *\n * @param config\n * @param files\n * @category utils\n */\nexport function rulesMatchAnyFiles(config: AnyConfiguration, files: string[]): boolean {\n  const rules = getRulesByMatchingFiles(config, files);\n  return Object.keys(rules).some(filename => !!rules[filename].length);\n}\n\n/**\n *\n * @param rule\n * @category utils\n */\nexport function resolveRuleSetUse(rule?: RuleSetUse | RuleSetUse[]): ResolvedRuleSet[] {\n  if (!rule) return [];\n  if (Array.isArray(rule)) {\n    const rules = rule as RuleSetUse[];\n    let resolved: ResolvedRuleSet[] = [];\n    for (const rule of rules) {\n      resolved = [...resolved, ...resolveRuleSetUse(rule)];\n    }\n    return resolved;\n  } else if (typeof rule === 'string' || isRuleSetLoader(rule)) {\n    return [rule];\n  } else if (typeof rule === 'function') {\n    return resolveRuleSetUse(rule({}));\n  }\n  return [rule];\n}\n\n/**\n *\n * @param condition\n * @param file\n * @category utils\n */\nexport function conditionMatchesFile(\n  condition: RuleSetCondition | undefined,\n  file: string\n): boolean {\n  if (!condition) return false;\n  if (isRegExp(condition)) {\n    return condition.test(file);\n  } else if (typeof condition === 'string') {\n    return file.startsWith(condition);\n  } else if (typeof condition === 'function') {\n    return Boolean(condition(file));\n  } else if (Array.isArray(condition)) {\n    return condition.some(c => conditionMatchesFile(c, file));\n  }\n  return Object.entries(condition)\n    .map(([key, value]) => {\n      switch (key) {\n        case 'test':\n          return conditionMatchesFile(value, file);\n        case 'include':\n          return conditionMatchesFile(value, file);\n        case 'exclude':\n          return !conditionMatchesFile(value, file);\n        case 'and':\n          return (value as RuleSetCondition[]).every(c => conditionMatchesFile(c, file));\n        case 'or':\n          return (value as RuleSetCondition[]).some(c => conditionMatchesFile(c, file));\n        case 'not':\n          return (value as RuleSetCondition[]).every(c => !conditionMatchesFile(c, file));\n        default:\n          return true;\n      }\n    })\n    .every(b => b);\n}\n\n/**\n *\n * @param param0\n * @category utils\n */\nexport function getPlugins({ plugins = [] }: AnyConfiguration): PluginItem[] {\n  return plugins.map((plugin, index) => ({ index, plugin }));\n}\n\n/**\n *\n * @param config\n * @param name\n * @category utils\n */\nexport function getPluginsByName(config: AnyConfiguration, name: string): PluginItem[] {\n  return getPlugins(config).filter(({ plugin }: PluginItem) => {\n    if (plugin && plugin.constructor) {\n      return plugin.constructor.name === name;\n    }\n    return false;\n  });\n}\n\n/**\n *\n * @param loader\n * @category utils\n */\nexport function isRuleSetItem(loader: RuleSetUse): loader is RuleSetUseItem {\n  return typeof loader === 'string' || typeof loader === 'function' || isRuleSetLoader(loader);\n}\n\n/**\n *\n * @param loader\n * @category utils\n */\nexport function isRuleSetLoader(loader: RuleSetUse): loader is RuleSetLoader {\n  return Object.keys(loader).some(k => ['loader', 'options', 'indent', 'query'].includes(k));\n}\n\n/**\n *\n * @param arg\n * @category utils\n */\nexport function isEntry(arg: any): arg is Entry {\n  if (typeof arg !== 'object' || arg === null) {\n    return false;\n  }\n  return Object.values(arg).every(value => {\n    if (Array.isArray(value)) {\n      return value.every(value => typeof value === 'string');\n    }\n    return typeof value === 'string';\n  });\n}\n\n/**\n *\n * @param arg\n * @category utils\n */\nexport async function resolveEntryAsync(arg: any): Promise<Entry> {\n  if (typeof arg === 'undefined') {\n    throw new Error('Webpack config entry cannot be undefined');\n  }\n\n  if (typeof arg === 'function') {\n    return resolveEntryAsync(await arg());\n  } else if (typeof arg === 'string') {\n    return resolveEntryAsync([arg]);\n  } else if (Array.isArray(arg)) {\n    return {\n      app: arg,\n    };\n  } else if (isEntry(arg)) {\n    return arg;\n  }\n\n  throw new Error('Cannot resolve Webpack config entry prop: ' + arg);\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}