{"ast":null,"code":"\"use strict\";var _defineProperty=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/defineProperty\");var _objectWithoutProperties=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/objectWithoutProperties\");var _toConsumableArray=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/toConsumableArray\");var _slicedToArray=require(\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/slicedToArray\");var _excluded=[\"mode\",\"projectRoot\",\"babelProjectRoot\",\"include\",\"verbose\",\"platform\",\"useCustom\"];function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!==\"undefined\"&&o[Symbol.iterator]||o[\"@@iterator\"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e){throw _e;},f:F};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e2){didErr=true;err=_e2;},f:function f(){try{if(!normalCompletion&&it[\"return\"]!=null)it[\"return\"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{\"default\":mod};};Object.defineProperty(exports,\"__esModule\",{value:true});exports.createBabelLoaderFromEnvironment=void 0;var core_1=require(\"@babel/core\");var paths_1=require(\"@expo/config/paths\");var chalk_1=__importDefault(require(\"chalk\"));var fs_extra_1=__importDefault(require(\"fs-extra\"));var getenv_1=require(\"getenv\");var path_1=__importDefault(require(\"path\"));var resolve_from_1=__importDefault(require(\"resolve-from\"));var env_1=require(\"../env\");// Source maps are resource heavy and can cause out of memory issue for large source files.\nvar shouldUseSourceMap=(0,getenv_1.boolish)('GENERATE_SOURCEMAP',true);var getModule=function getModule(name){return path_1[\"default\"].join('node_modules',name);};// Only compile files from the react ecosystem.\nvar includeModulesThatContainPaths=[getModule('react-native'),getModule('react-navigation'),getModule('expo'),getModule('unimodules'),getModule('@react'),getModule('@expo'),getModule('@use-expo'),getModule('@unimodules'),getModule('native-base'),getModule('styled-components')];var excludedRootPaths=['/node_modules','/bower_components','/.expo/',// Prevent transpiling webpack generated files.\n'(webpack)'];var parsedPackageNames=[];// TODO: Bacon: Support internal packages. ex: react/fbjs\nfunction packageNameFromPath(inputPath){var modules=inputPath.split('node_modules/');var libAndFile=modules.pop();if(!libAndFile)return null;if(libAndFile.charAt(0)==='@'){var _libAndFile$split=libAndFile.split('/'),_libAndFile$split2=_slicedToArray(_libAndFile$split,2),org=_libAndFile$split2[0],lib=_libAndFile$split2[1];return org+'/'+lib;}else{var components=libAndFile.split('/');var first=components.shift();return first||null;}}function logPackage(packageName){if(!parsedPackageNames.includes(packageName)){parsedPackageNames.push(packageName);console.log(chalk_1[\"default\"].cyan('\\nCompiling module: '+chalk_1[\"default\"].bold(packageName)));}}function ensureRoot(possibleProjectRoot){if(typeof possibleProjectRoot==='string'){return path_1[\"default\"].resolve(possibleProjectRoot);}return(0,paths_1.getPossibleProjectRoot)();}function generateCacheIdentifier(projectRoot){var version=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'1';var filename=path_1[\"default\"].join(projectRoot,'foobar.js');var cacheKey=\"babel-cache-\".concat(version,\"-\");var partial=(0,core_1.loadPartialConfig)({filename:filename,cwd:projectRoot,sourceFileName:filename});return\"\".concat(cacheKey).concat(JSON.stringify(partial.options));}/**\n * Creates a Rule for loading Application code and packages from the Expo ecosystem.\n * This method attempts to recreate how Metro loads ES modules in the `node_modules` folder.\n *\n * @param env\n * @internal\n */function createBabelLoaderFromEnvironment(env){var _a;var mode=(0,env_1.getMode)(env);var locations=env.locations||(0,env_1.getPaths)(env.projectRoot,env);var appConfig=env.config||(0,env_1.getConfig)(env);var _appConfig$web$build=appConfig.web.build,build=_appConfig$web$build===void 0?{}:_appConfig$web$build;var _build$babel=build.babel,babel=_build$babel===void 0?{}:_build$babel;return createBabelLoader({projectRoot:locations.root,mode:mode,platform:env.platform,babelProjectRoot:babel.root||locations.root,verbose:babel.verbose,include:[].concat(_toConsumableArray(babel.include||[]),_toConsumableArray(((_a=env.babel)===null||_a===void 0?void 0:_a.dangerouslyAddModulePathsToTranspile)||[])),use:babel.use});}exports.createBabelLoaderFromEnvironment=createBabelLoaderFromEnvironment;/**\n * A complex babel loader which uses the project's `babel.config.js`\n * to resolve all of the Unimodules which are shipped as ES modules (early 2019).\n * @category loaders\n */function createBabelLoader(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var mode=_ref.mode,inputProjectRoot=_ref.projectRoot,babelProjectRoot=_ref.babelProjectRoot,_ref$include=_ref.include,include=_ref$include===void 0?[]:_ref$include,verbose=_ref.verbose,_ref$platform=_ref.platform,platform=_ref$platform===void 0?'web':_ref$platform,useCustom=_ref.useCustom,options=_objectWithoutProperties(_ref,_excluded);var ensuredProjectRoot=ensureRoot(babelProjectRoot);var modules=[].concat(includeModulesThatContainPaths,_toConsumableArray(include));var customUse=options.use||{};var customUseOptions=customUse.options||{};var isProduction=mode==='production';var projectRoot=inputProjectRoot||(0,paths_1.getPossibleProjectRoot)();var presetOptions={// Explicitly use babel.config.js instead of .babelrc\nbabelrc:false,// Attempt to use local babel.config.js file for compiling project.\nconfigFile:true};if(!fs_extra_1[\"default\"].existsSync(path_1[\"default\"].join(projectRoot,'babel.config.js'))&&!fs_extra_1[\"default\"].existsSync(path_1[\"default\"].join(projectRoot,'.babelrc'))){// If no babel config exists then fallback on the default `babel-preset-expo`\n// which is installed with `expo`.\nvar modulePath=resolve_from_1[\"default\"].silent(projectRoot,'babel-preset-expo');if(modulePath){presetOptions={babelrc:false,configFile:false,presets:[modulePath]};}else{console.log(chalk_1[\"default\"].yellow(\"\\u203A Webpack failed to locate a valid Babel config\"));}}presetOptions=_objectSpread(_objectSpread(_objectSpread({},presetOptions),customUseOptions||{}),{},{sourceType:'unambiguous',root:ensuredProjectRoot,compact:isProduction,// Babel sourcemaps are needed for debugging into node_modules\n// code.  Without the options below, debuggers like VSCode\n// show incorrect code and set breakpoints on the wrong lines.\nsourceMaps:shouldUseSourceMap,inputSourceMap:shouldUseSourceMap});var cacheIdentifier=customUseOptions.cacheIdentifier;if(!cacheIdentifier){try{cacheIdentifier=generateCacheIdentifier(ensuredProjectRoot);}catch(error){console.log(chalk_1[\"default\"].black.bgRed(\"The project's Babel config is invalid: \".concat(error.message)));throw error;}}presetOptions.cacheIdentifier=cacheIdentifier;presetOptions.cacheCompression=false;presetOptions.cacheDirectory=customUseOptions.cacheDirectory||path_1[\"default\"].join(ensuredProjectRoot,'.expo',platform,'cache',mode||'development','babel-loader');presetOptions.caller={__dangerous_rule_id:'expo-babel-loader',bundler:'webpack',platform:platform,mode:mode};return _objectSpread(_objectSpread({test:/\\.(mjs|[jt]sx?)$/},options),{},{include:function include(inputPath){var _iterator=_createForOfIteratorHelper(modules),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var possibleModule=_step.value;if(inputPath.includes(path_1[\"default\"].normalize(possibleModule))){if(verbose){var packageName=packageNameFromPath(inputPath);if(packageName)logPackage(packageName);}return true;}}// Is inside the project and is not one of designated modules\n}catch(err){_iterator.e(err);}finally{_iterator.f();}if(inputPath.includes(ensuredProjectRoot)){var _iterator2=_createForOfIteratorHelper(excludedRootPaths),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var excluded=_step2.value;if(inputPath.includes(path_1[\"default\"].normalize(excluded))){return false;}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return true;}return false;},use:_objectSpread(_objectSpread({},customUse),{},{loader:require.resolve('babel-loader'),options:presetOptions})});}exports[\"default\"]=createBabelLoader;","map":{"version":3,"sources":["../../src/loaders/createBabelLoader.ts"],"names":[],"mappings":"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","sourcesContent":["import { loadPartialConfig } from '@babel/core';\nimport { getPossibleProjectRoot } from '@expo/config/paths';\nimport chalk from 'chalk';\nimport fs from 'fs-extra';\nimport { boolish } from 'getenv';\nimport path from 'path';\nimport resolveFrom from 'resolve-from';\nimport { Rule } from 'webpack';\n\nimport { getConfig, getMode, getPaths } from '../env';\nimport { Environment, Mode } from '../types';\n\n// Source maps are resource heavy and can cause out of memory issue for large source files.\nconst shouldUseSourceMap = boolish('GENERATE_SOURCEMAP', true);\n\nconst getModule = (name: string) => path.join('node_modules', name);\n\n// Only compile files from the react ecosystem.\nconst includeModulesThatContainPaths = [\n  getModule('react-native'),\n  getModule('react-navigation'),\n  getModule('expo'),\n  getModule('unimodules'),\n  getModule('@react'),\n  getModule('@expo'),\n  getModule('@use-expo'),\n  getModule('@unimodules'),\n  getModule('native-base'),\n  getModule('styled-components'),\n];\n\nconst excludedRootPaths = [\n  '/node_modules',\n  '/bower_components',\n  '/.expo/',\n  // Prevent transpiling webpack generated files.\n  '(webpack)',\n];\n\nconst parsedPackageNames: string[] = [];\n// TODO: Bacon: Support internal packages. ex: react/fbjs\nfunction packageNameFromPath(inputPath: string): string | null {\n  const modules = inputPath.split('node_modules/');\n  const libAndFile = modules.pop();\n  if (!libAndFile) return null;\n  if (libAndFile.charAt(0) === '@') {\n    const [org, lib] = libAndFile.split('/');\n    return org + '/' + lib;\n  } else {\n    const components = libAndFile.split('/');\n    const first = components.shift();\n    return first || null;\n  }\n}\n\nfunction logPackage(packageName: string) {\n  if (!parsedPackageNames.includes(packageName)) {\n    parsedPackageNames.push(packageName);\n    console.log(chalk.cyan('\\nCompiling module: ' + chalk.bold(packageName)));\n  }\n}\n\nfunction ensureRoot(possibleProjectRoot?: string): string {\n  if (typeof possibleProjectRoot === 'string') {\n    return path.resolve(possibleProjectRoot);\n  }\n  return getPossibleProjectRoot();\n}\n\nfunction generateCacheIdentifier(projectRoot: string, version: string = '1'): string {\n  const filename = path.join(projectRoot, 'foobar.js');\n  const cacheKey = `babel-cache-${version}-`;\n\n  const partial = loadPartialConfig({\n    filename,\n    cwd: projectRoot,\n    sourceFileName: filename,\n  });\n\n  return `${cacheKey}${JSON.stringify(partial!.options)}`;\n}\n\n/**\n * Creates a Rule for loading Application code and packages from the Expo ecosystem.\n * This method attempts to recreate how Metro loads ES modules in the `node_modules` folder.\n *\n * @param env\n * @internal\n */\nexport function createBabelLoaderFromEnvironment(\n  env: Pick<Environment, 'babel' | 'locations' | 'projectRoot' | 'config' | 'mode' | 'platform'>\n): Rule {\n  const mode = getMode(env);\n  const locations = env.locations || getPaths(env.projectRoot, env);\n  const appConfig = env.config || getConfig(env);\n\n  const { build = {} } = appConfig.web;\n  const { babel = {} } = build;\n\n  return createBabelLoader({\n    projectRoot: locations.root,\n    mode,\n    platform: env.platform,\n    babelProjectRoot: babel.root || locations.root,\n    verbose: babel.verbose,\n    include: [...(babel.include || []), ...(env.babel?.dangerouslyAddModulePathsToTranspile || [])],\n    use: babel.use,\n  });\n}\n/**\n * A complex babel loader which uses the project's `babel.config.js`\n * to resolve all of the Unimodules which are shipped as ES modules (early 2019).\n * @category loaders\n */\nexport default function createBabelLoader({\n  /**\n   * The webpack mode: `\"production\" | \"development\"`\n   */\n  mode,\n  projectRoot: inputProjectRoot,\n  babelProjectRoot,\n  include = [],\n  verbose,\n  platform = 'web',\n  useCustom,\n  ...options\n}: {\n  projectRoot?: string;\n  useCustom?: boolean;\n  mode?: Mode;\n  babelProjectRoot?: string;\n  include?: string[];\n  verbose?: boolean;\n  [key: string]: any;\n} = {}): Rule {\n  const ensuredProjectRoot = ensureRoot(babelProjectRoot);\n  const modules = [...includeModulesThatContainPaths, ...include];\n  const customUse = options.use || {};\n  const customUseOptions = customUse.options || {};\n\n  const isProduction = mode === 'production';\n\n  const projectRoot = inputProjectRoot || getPossibleProjectRoot();\n  let presetOptions: any = {\n    // Explicitly use babel.config.js instead of .babelrc\n    babelrc: false,\n    // Attempt to use local babel.config.js file for compiling project.\n    configFile: true,\n  };\n\n  if (\n    !fs.existsSync(path.join(projectRoot, 'babel.config.js')) &&\n    !fs.existsSync(path.join(projectRoot, '.babelrc'))\n  ) {\n    // If no babel config exists then fallback on the default `babel-preset-expo`\n    // which is installed with `expo`.\n    const modulePath = resolveFrom.silent(projectRoot, 'babel-preset-expo');\n    if (modulePath) {\n      presetOptions = {\n        babelrc: false,\n        configFile: false,\n        presets: [modulePath],\n      };\n    } else {\n      console.log(chalk.yellow('\\u203A Webpack failed to locate a valid Babel config'));\n    }\n  }\n\n  presetOptions = {\n    ...presetOptions,\n    ...(customUseOptions || {}),\n\n    sourceType: 'unambiguous',\n    root: ensuredProjectRoot,\n    compact: isProduction,\n    // Babel sourcemaps are needed for debugging into node_modules\n    // code.  Without the options below, debuggers like VSCode\n    // show incorrect code and set breakpoints on the wrong lines.\n    sourceMaps: shouldUseSourceMap,\n    inputSourceMap: shouldUseSourceMap,\n  };\n\n  let cacheIdentifier: string | undefined = customUseOptions.cacheIdentifier;\n  if (!cacheIdentifier) {\n    try {\n      cacheIdentifier = generateCacheIdentifier(ensuredProjectRoot);\n    } catch (error: any) {\n      console.log(chalk.black.bgRed(`The project's Babel config is invalid: ${error.message}`));\n\n      throw error;\n    }\n  }\n  presetOptions.cacheIdentifier = cacheIdentifier;\n  presetOptions.cacheCompression = false;\n  presetOptions.cacheDirectory =\n    customUseOptions.cacheDirectory ||\n    path.join(\n      ensuredProjectRoot,\n      '.expo',\n      platform,\n      'cache',\n      mode || 'development',\n      'babel-loader'\n    );\n  presetOptions.caller = {\n    __dangerous_rule_id: 'expo-babel-loader',\n    bundler: 'webpack',\n    platform,\n    mode,\n  };\n  return {\n    test: /\\.(mjs|[jt]sx?)$/,\n    // Can only clobber test\n    // Prevent clobbering the `include` and `use` values.\n    ...options,\n    include(inputPath: string): boolean {\n      for (const possibleModule of modules) {\n        if (inputPath.includes(path.normalize(possibleModule))) {\n          if (verbose) {\n            const packageName = packageNameFromPath(inputPath);\n            if (packageName) logPackage(packageName);\n          }\n          return true;\n        }\n      }\n      // Is inside the project and is not one of designated modules\n      if (inputPath.includes(ensuredProjectRoot)) {\n        for (const excluded of excludedRootPaths) {\n          if (inputPath.includes(path.normalize(excluded))) {\n            return false;\n          }\n        }\n        return true;\n      }\n      return false;\n    },\n    use: {\n      ...customUse,\n      loader: require.resolve('babel-loader'),\n      options: presetOptions,\n    },\n  };\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}