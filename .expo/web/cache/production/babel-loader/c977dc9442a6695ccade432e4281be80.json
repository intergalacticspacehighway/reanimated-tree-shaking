{"ast":null,"code":"import _slicedToArray from\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/esm/slicedToArray\";import _toConsumableArray from\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/fernandorojo/Developer/messing/rea-tree/node_modules/next/dist/compiled/@babel/runtime/helpers/esm/createClass\";var MapperRegistry=/*#__PURE__*/function(){function MapperRegistry(module){_classCallCheck(this,MapperRegistry);this.sortedMappers=[];this.mappers=new Map();this.updatedSinceLastExecute=false;this._module=module;}_createClass(MapperRegistry,[{key:\"startMapper\",value:function startMapper(mapper){this.mappers.set(mapper.id,mapper);this.updatedSinceLastExecute=true;return mapper.id;}},{key:\"stopMapper\",value:function stopMapper(id){this.mappers[\"delete\"](id);this.updatedSinceLastExecute=true;}},{key:\"execute\",value:function execute(){if(this.updatedSinceLastExecute){this.updateOrder();this.updatedSinceLastExecute=false;}for(var i=0,len=this.sortedMappers.length;i<len;++i){var mapper=this.sortedMappers[i];if(mapper.dirty){mapper.execute();}}}},{key:\"updateOrder\",value:function updateOrder(){var nodes=_toConsumableArray(this.mappers.values()).map(function(mapper){return new Node(mapper);});var mappersById={};this.mappers.forEach(function(mapper){mappersById[mapper.id]=mapper;});// create a graph from array of nodes\nfor(var i=0,nodesLen=nodes.length;i<nodesLen;++i){var node=nodes[i];if(node.mapper.outputs.length===0){continue;}for(var j=0;j<nodesLen;++j){var restNode=nodes[j];if(i===j||restNode.mapper.inputs.length===0){continue;}for(var outi=0,outputsLen=node.mapper.outputs.length;outi<outputsLen;++outi){for(var resti=0,restLen=restNode.mapper.inputs.length;resti<restLen;++resti){if(node.mapper.outputs[outi]._id===restNode.mapper.inputs[resti]._id){node.children.push(restNode);}}}}}var post={};var postCounter=1;var dfs=function dfs(node){var index=nodes.indexOf(node);if(index===-1){// this node has already been handled\nreturn;}++postCounter;nodes.splice(index,1);if(node.children.length===0&&nodes.length>0){post[node.mapper.id]=postCounter++;dfs(nodes[0]);return;}for(var _i=0,len=node.children.length;_i<len;++_i){dfs(node.children[_i]);}post[node.mapper.id]=postCounter++;};while(nodes.length){dfs(nodes[0]);}var postArray=Object.keys(post).map(function(key){var num=parseInt(key);return[num,post[num]];});postArray.sort(function(a,b){return b[1]-a[1];});// clear sorted mappers\nthis.sortedMappers=[];for(var _i2=0,len=postArray.length;_i2<len;++_i2){var _postArray$_i=_slicedToArray(postArray[_i2],1),id=_postArray$_i[0];this.sortedMappers.push(mappersById[id]);}}},{key:\"needRunOnRender\",get:function get(){return this.updatedSinceLastExecute;}}]);return MapperRegistry;}();export{MapperRegistry as default};var Node=function Node(mapper){var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];_classCallCheck(this,Node);this.mapper=mapper;this.children=children;};","map":{"version":3,"names":["MapperRegistry","module","sortedMappers","mappers","Map","updatedSinceLastExecute","_module","mapper","set","id","updateOrder","i","len","length","dirty","execute","nodes","values","map","Node","mappersById","forEach","nodesLen","node","outputs","j","restNode","inputs","outi","outputsLen","resti","restLen","_id","children","push","post","postCounter","dfs","index","indexOf","splice","postArray","Object","keys","key","num","parseInt","sort","a","b"],"sources":["/Users/fernandorojo/Developer/messing/rea-tree/node_modules/react-native-reanimated/lib/reanimated2/js-reanimated/MapperRegistry.js"],"sourcesContent":["export default class MapperRegistry {\n  constructor(module) {\n    this.sortedMappers = [];\n    this.mappers = new Map();\n    this.updatedSinceLastExecute = false;\n    this._module = module;\n  }\n\n  startMapper(mapper) {\n    this.mappers.set(mapper.id, mapper);\n    this.updatedSinceLastExecute = true;\n    return mapper.id;\n  }\n\n  stopMapper(id) {\n    this.mappers.delete(id);\n    this.updatedSinceLastExecute = true;\n  }\n\n  execute() {\n    if (this.updatedSinceLastExecute) {\n      this.updateOrder();\n      this.updatedSinceLastExecute = false;\n    }\n\n    for (let i = 0, len = this.sortedMappers.length; i < len; ++i) {\n      const mapper = this.sortedMappers[i];\n\n      if (mapper.dirty) {\n        mapper.execute();\n      }\n    }\n  }\n\n  updateOrder() {\n    const nodes = [...this.mappers.values()].map(mapper => new Node(mapper));\n    const mappersById = {};\n    this.mappers.forEach(mapper => {\n      mappersById[mapper.id] = mapper;\n    }); // create a graph from array of nodes\n\n    for (let i = 0, nodesLen = nodes.length; i < nodesLen; ++i) {\n      const node = nodes[i];\n\n      if (node.mapper.outputs.length === 0) {\n        continue;\n      }\n\n      for (let j = 0; j < nodesLen; ++j) {\n        const restNode = nodes[j];\n\n        if (i === j || restNode.mapper.inputs.length === 0) {\n          continue;\n        }\n\n        for (let outi = 0, outputsLen = node.mapper.outputs.length; outi < outputsLen; ++outi) {\n          for (let resti = 0, restLen = restNode.mapper.inputs.length; resti < restLen; ++resti) {\n            if (node.mapper.outputs[outi]._id === restNode.mapper.inputs[resti]._id) {\n              node.children.push(restNode);\n            }\n          }\n        }\n      }\n    }\n\n    const post = {};\n    let postCounter = 1;\n\n    const dfs = node => {\n      const index = nodes.indexOf(node);\n\n      if (index === -1) {\n        // this node has already been handled\n        return;\n      }\n\n      ++postCounter;\n      nodes.splice(index, 1);\n\n      if (node.children.length === 0 && nodes.length > 0) {\n        post[node.mapper.id] = postCounter++;\n        dfs(nodes[0]);\n        return;\n      }\n\n      for (let i = 0, len = node.children.length; i < len; ++i) {\n        dfs(node.children[i]);\n      }\n\n      post[node.mapper.id] = postCounter++;\n    };\n\n    while (nodes.length) dfs(nodes[0]);\n\n    const postArray = Object.keys(post).map(key => {\n      const num = parseInt(key);\n      return [num, post[num]];\n    });\n    postArray.sort((a, b) => {\n      return b[1] - a[1];\n    }); // clear sorted mappers\n\n    this.sortedMappers = [];\n\n    for (let i = 0, len = postArray.length; i < len; ++i) {\n      const [id] = postArray[i];\n      this.sortedMappers.push(mappersById[id]);\n    }\n  }\n\n  get needRunOnRender() {\n    return this.updatedSinceLastExecute;\n  }\n\n}\n\nclass Node {\n  constructor(mapper, children = []) {\n    this.mapper = mapper;\n    this.children = children;\n  }\n\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}